<html>
<head>
  <script type="text/javascript">
    var latitude, longitude;
    function getGPS(){
      var options = {
        enableHighAccuracy: false,
        timeout: 5000,
        maximumAge: 0
      };

      if(navigator.geolocation) {

         // timeout at 60000 milliseconds (60 seconds)
         var options = {timeout:60000};
         navigator.geolocation.getCurrentPosition(showLocation, errorHandler, options);
      } else {
         alert("Sorry, browser does not support geolocation!");
      }
    }
    function errorHandler(err) {
        if(err.code == 1) {
           alert("Error: Access is denied!");
        } else if( err.code == 2) {
           alert("Error: Position is unavailable!");
        }
     }
    function showLocation(position) {
       latitude = position.coords.latitude;
       longitude = position.coords.longitude;
       document.getElementById("lat").innerHTML = latitude;
       document.getElementById("lng").innerHTML = longitude;

       //alert("Latitude : " + latitude + " Longitude: " + longitude);
    }

    function requestOrientationPermission(){
        DeviceOrientationEvent.requestPermission()
        .then(response => {
            if (response == 'granted') {
                window.addEventListener('deviceorientation', (e) => {
                    // do something with e
                    orientationEvent(e);

                })
            }
        })
        .catch(console.error)
    }
    function orientationEvent(e){
      document.getElementById("DeviceOrientationMsg").innerHTML = "DeviceOrientation";
      document.getElementById("doTiltLR").innerHTML = Math.round(e.gamma);
      document.getElementById("doTiltFB").innerHTML = Math.round(e.beta);
      document.getElementById("doDirection").innerHTML = Math.round(e.alpha);
      heading = Math.round(e.alpha);
      // if (Math.round(e.alpha) > 0 && Math.round(e.alpha) <= 45){
      //   heading = 360 - (latitude-Math.round(e.alpha));
      //
      // } else{
      //   heading = Math.round(e.alpha) - latitude;
      //
      // }
      headingEasy="";
      if ((heading >= 315 && heading < 360) || (heading >= 0 && heading < 45)){
        headingEasy="N";
      }
      else if (heading >= 45 && heading < 135) {
        headingEasy="E";
      }
      else if (heading >= 135 && heading < 225){
        headingEasy="S";
      }
      else if (heading >= 225 && heading < 315){
        headingEasy="W";
      }
      document.getElementById("heading").innerHTML = heading;
      document.getElementById("headingEasy").innerHTML = headingEasy;

    }


    function requestMotionPermission(){
        DeviceMotionEvent.requestPermission()
        .then(response => {
            if (response == 'granted') {

                window.addEventListener('devicemotion', (e) => {
                    // do something with e
                    motionEvent(e);

                })
            }
        })
        .catch(console.error)
    }

    function motionEvent(e){
      acceleration = e.accelerationIncludingGravity;
      document.getElementById("DeviceMotionMsg").innerHTML = "DeviceMotion";
      document.getElementById("accelX").innerHTML = acceleration.x;
      document.getElementById("accelY").innerHTML = acceleration.y;
      document.getElementById("accelZ").innerHTML = acceleration.z;
    }
    function init(){
      getGPS();
      requestMotionPermission();
      requestOrientationPermission();
    }
  </script>
</head>

<body onload="init();">
  <h2>Device Motion</h2>
  <table>
    <tr>
      <td>Lat</td>
      <td id="lat">-</td>
    </tr>

    <tr>
      <td>lng</td>
      <td id="lng">-</td>
    </tr>

  </table>
  <h2>Device Orientation</h2>
  <table>
    <tr>
      <td>Event Supported</td>
      <td id="DeviceOrientationMsg">-</td>
    </tr>
    <tr>
      <td>Tilt Left/Right [gamma]</td>
      <td id="doTiltLR">-</td>
    </tr>
    <tr>
      <td>Tilt Front/Back [beta]</td>
      <td id="doTiltFB">-</td>
    </tr>
    <tr>
      <td>Direction [alpha]</td>
      <td id="doDirection">-</td>
    </tr>
    <tr>
      <td>Heading</td>
      <td id="heading">-</td>
    </tr>
    <tr>
      <td>Heading Easy</td>
      <td id="headingEasy">-</td>
    </tr>

   </table>
  <h2>Device Motion</h2>
  <table>
    <tr>
      <td>Event Supported</td>
      <td id="DeviceMotionMsg">-</td>
    </tr>

    <tr>
      <td>accelX</td>
      <td id="accelX">-</td>
    </tr>
    <tr>
      <td>accelY</td>
      <td id="accelY">-</td>
    </tr>
    <tr>
      <td>accelZ</td>
      <td id="accelZ">-</td>
    </tr>
    <tr>
      <td>rotationRate</td>
      <td id="moRotation">-</td>
    </tr>
    <tr>
      <td>interval</td>
      <td id="moInterval">-</td>
    </tr>
  </table>

</body>
</html>
